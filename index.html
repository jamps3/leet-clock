<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Leet Clock</title>
    <style>
      :root {
        --bg-color: black;
        --text-color: lime;
        --text-color-light: #333; /* Darker text for light theme */
      }
      body {
        background-color: var(--bg-color);
        color: var(--text-color);
        font-family: monospace;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        height: 100vh;
        overflow: hidden;
        transition: background-color 0.5s, color 0.5s;
      }
      svg {
        background-color: transparent;
      }
      .background {
        position: fixed;
        width: 100%;
        height: 100%;
        top: 0;
        left: 0;
        z-index: -1;
        background: radial-gradient(
          circle,
          rgba(0, 255, 0, 0.2) 0%,
          rgba(0, 0, 0, 1) 100%
        );
        animation: pulse 5s infinite;
      }
      @keyframes pulse {
        0% {
          opacity: 0.9;
        }
        50% {
          opacity: 0.5;
        }
        100% {
          opacity: 0.9;
        }
      }
      #quote {
        position: absolute;
        top: 40px;
        width: 100%;
        text-align: center;
        font-size: 1rem;
        color: var(--text-color);
      }

      #digital {
        font-size: 1.5rem;
        margin-top: 1rem;
        color: var(--text-color);
      }
      #toggleTheme,
      #toggleMode {
        position: absolute;
        top: 10px;
        background: none;
        border: 1px solid var(--text-color);
        color: var(--text-color);
        padding: 5px 10px;
        font-family: monospace;
        cursor: pointer;
      }
      #toggleTheme {
        right: 10px;
      }
      #toggleMode {
        left: 10px;
      }
      #startup {
        position: absolute;
        width: 100%;
        height: 100%;
        background-color: black;
        color: lime;
        font-size: 2rem;
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 10;
        animation: fadeOut 1s forwards;
      }
      @keyframes fadeOut {
        0% {
          opacity: 1;
        }
        90% {
          opacity: 1;
        }
        100% {
          opacity: 0;
          visibility: hidden;
        }
      }
      #locationControls {
        position: absolute;
        bottom: 10px;
        left: 50%;
        transform: translateX(-50%);
        font-family: monospace;
        color: var(--text-color);
        font-size: 0.9rem;
        display: flex;
        flex-wrap: wrap;
        gap: 6px;
        justify-content: center;
        align-items: center;
      }

      #locationControls input,
      #locationControls button {
        background: none;
        border: 1px solid var(--text-color);
        color: var(--text-color);
        padding: 4px 6px;
        font-family: monospace;
        font-size: 0.9rem;
        width: 100px;
        box-sizing: border-box;
      }

      #locationControls input::placeholder {
        color: var(--text-color);
        opacity: 0.6;
      }

      #locationControls button:hover {
        background-color: var(--text-color);
        color: var(--bg-color);
        cursor: pointer;
      }
      #locationControls select {
        background: none;
        border: 1px solid var(--text-color);
        color: var(--text-color);
        padding: 4px 6px;
        font-family: monospace;
        font-size: 0.9rem;
        width: 150px;
      }

      #locationControls select option {
        background-color: black;
        color: lime;
      }
    </style>
    <script src="https://unpkg.com/suncalc@1.9.0/suncalc.js"></script>
  </head>
  <body>
    <div id="startup">LOADING . . . 1337 MODE INITIALIZING</div>
    <div class="background"></div>
    <button id="toggleTheme" aria-label="Toggle between dark and light theme">
      Toggle Theme
    </button>
    <button id="toggleMode" aria-label="Switch clock mode">
      Mode: Leet time
    </button>
    <button id="resetLocationBtn" aria-label="Reset location to default">
      Reset Location
    </button>
    <div id="quote"></div>
    <div id="locationControls">
      <label>Location:</label>
      <select id="citySelect">
        <option value="">-- Choose City --</option>
        <option value="60.1699,24.9384">Helsinki</option>
        <option value="59.3293,18.0686">Stockholm</option>
        <option value="52.5200,13.4050">Berlin</option>
        <option value="51.5074,-0.1278">London</option>
        <option value="40.7128,-74.0060">New York</option>
        <option value="34.0522,-118.2437">Los Angeles</option>
        <option value="35.6895,139.6917">Tokyo</option>
        <option value="-33.8688,151.2093">Sydney</option>
        <option value="5.3453,-4.0244">Abidjan</option>
        <option value="23.0225,72.5714">Ahmedabad</option>
        <option value="31.2001,29.9187">Alexandria</option>
        <option value="13.0827,80.2707">Chennai</option>
        <option value="30.5728,104.0668">Chengdu</option>
        <option value="22.5726,88.3639">Kolkata</option>
        <option value="22.3569,91.7832">Chittagong</option>
        <option value="29.4316,106.9123">Chongqing</option>
        <option value="-6.7924,39.2083">Dar es Salaam</option>
        <option value="28.7041,77.1025">Delhi</option>
        <option value="23.0205,113.7518">Dongguan</option>
        <option value="9.0300,38.7400">Addis Ababa</option>
        <option value="39.9042,116.4074">Beijing</option>
        <option value="-19.9167,-43.9345">Belo Horizonte</option>
        <option value="4.7110,-74.0721">BogotÃ¡</option>
        <option value="41.3851,2.1734">Barcelona</option>
        <option value="-34.6037,-58.3816">Buenos Aires</option>
        <option value="30.0444,31.2357">Cairo</option>
        <option value="34.3416,108.9398">Xi'an</option>
        <option value="12.9716,77.5946">Bangalore</option>
        <option value="39.3434,117.3616">Tianjin</option>
        <option value="18.5204,73.8567">Pune</option>
        <option value="55.7558,37.6173">Moscow</option>
        <option value="19.4326,-99.1332">Mexico City</option>
        <option value="19.0760,72.8777">Mumbai</option>
        <option value="37.5665,126.9780">Seoul</option>
        <option value="35.6895,139.6917">Tokyo</option>
        <option value="23.1291,113.2644">Guangzhou</option>
        <option value="20.6597,-103.3496">Guadalajara</option>
        <option value="30.2741,120.1551">Hangzhou</option>
        <option value="17.3850,78.4867">Hyderabad</option>
        <option value="13.7563,100.5018">Bangkok</option>
        <option value="-6.2088,106.8456">Jakarta</option>
        <option value="36.0662,120.3826">Qingdao</option>
        <option value="6.5244,3.3792">Lagos</option>
        <option value="34.6937,135.5023">Osaka</option>
        <option value="-33.4489,-70.6693">Santiago</option>
        <option value="-23.5505,-46.6333">SÃ£o Paulo</option>
        <option value="24.8607,67.0011">Karachi</option>
        <option value="24.7136,46.6753">Riyadh</option>
        <option value="40.7128,-74.0060">New York City</option>
        <option value="13.0827,80.2707">Chennai</option>
        <option value="22.3193,114.1694">Hong Kong</option>
        <option value="23.0215,113.7490">Foshan</option>
        <option value="-33.8688,151.2093">Sydney</option>
        <option value="21.1702,72.8311">Surat</option>
        <option value="35.6892,51.3890">Tehran</option>
        <option value="10.7769,106.7009">Ho Chi Minh City</option>
        <option value="51.5074,-0.1278">London</option>
      </select>
      <input type="number" id="latInput" placeholder="Latitude" step="0.1" />
      <input type="number" id="lonInput" placeholder="Longitude" step="0.1" />
      <button id="setLocationBtn" aria-label="Set custom location">Set</button>
      <button id="useGeoBtn" aria-label="Use my current location">
        Use My Location
      </button>
    </div>
    <svg id="leetClock" width="1024" height="768" viewBox="0 0 400 400">
      <circle
        cx="200"
        cy="200"
        r="180"
        stroke="lime"
        stroke-width="4"
        fill="none"
      />
      <g
        id="labels"
        fill="lime"
        font-family="monospace"
        text-anchor="middle"
        dominant-baseline="middle"
      ></g>
      <line
        id="minuteHand"
        x1="200"
        y1="200"
        x2="200"
        y2="50"
        stroke="lime"
        stroke-width="3"
        style="transition: all 0.5s ease"
      />
      <line
        id="hourHand"
        x1="200"
        y1="200"
        x2="200"
        y2="100"
        stroke="lime"
        stroke-width="6"
        style="transition: all 0.5s ease"
      />
      <circle cx="200" cy="200" r="10" fill="lime" />
    </svg>
    <div id="digital"></div>
    <audio id="sound"></audio>
    <script>
      if (realHours === 13 && realMinutes === 37 && realSeconds === 0) {
        // Only load the sound when needed, reducing initial load time
        const sound = document.getElementById("sound");
        if (!sound.src) {
          sound.src = "https://www.soundjay.com/button/beep-07.wav";
        }
        sound.play();
        document.getElementById("quote").textContent =
          "ðŸŽ‰ 13:37 Achieved! Stay leet. ðŸŽ‰";
      }
      const centerX = 200;
      const centerY = 200;
      let mode = "leet";

      const modeSettings = {
        leet: {
          hours: 13,
          minutes: 37,
          label: "Leet time",
          offset: 13 * 3600 + 37 * 60,
          hourFont: 24,
          minuteFont: 8,
        },
        real: {
          hours: 12,
          minutes: 60,
          label: "Real time",
          hourFont: 24,
          minuteFont: 10,
        },
        real24: {
          hours: 24,
          minutes: 60,
          label: "Real time 24h",
          hourFont: 18,
          minuteFont: 10,
        },
        sata: {
          hours: 100,
          minutes: 100,
          label: "Sata time",
          hourFont: 8,
          minuteFont: 8,
        },
        relative: {
          hours: 12,
          minutes: 60,
          label: "Relative Hour",
          hourFont: 24,
          minuteFont: 10,
        },
      };

      const labelGroup = document.getElementById("labels");

      function drawLabels(hourCount, minuteCount) {
        labelGroup.innerHTML = "";
        const hourRadius = 150;
        const minuteRadius = 170;
        const settings = modeSettings[mode];
        for (let i = 0; i < hourCount; i++) {
          const angle = ((360 / hourCount) * i - 90) * (Math.PI / 180);
          const x = centerX + hourRadius * Math.cos(angle);
          const y = centerY + hourRadius * Math.sin(angle);
          const text = document.createElementNS(
            "http://www.w3.org/2000/svg",
            "text"
          );
          text.setAttribute("x", x);
          text.setAttribute("y", y);
          text.setAttribute("font-size", settings.hourFont);
          text.textContent = i.toString();
          labelGroup.appendChild(text);
        }
        for (let i = 0; i < minuteCount; i++) {
          const angle = ((360 / minuteCount) * i - 90) * (Math.PI / 180);
          const x = centerX + minuteRadius * Math.cos(angle);
          const y = centerY + minuteRadius * Math.sin(angle);
          const text = document.createElementNS(
            "http://www.w3.org/2000/svg",
            "text"
          );
          text.setAttribute("x", x);
          text.setAttribute("y", y);
          text.setAttribute("font-size", settings.minuteFont);
          text.textContent = i.toString();
          labelGroup.appendChild(text);
        }
      }

      function getSunriseTime(date) {
        const times = SunCalc.getTimes(date, latitude, longitude);
        return times.sunrise;
      }

      function getSunsetTime(date) {
        const times = SunCalc.getTimes(date, latitude, longitude);
        return times.sunset;
      }

      function updateClock() {
        const now = new Date();
        const realHours = now.getHours();
        const realMinutes = now.getMinutes();
        const realSeconds = now.getSeconds();

        let customHour, customMinute;
        const settings = modeSettings[mode];

        if (mode === "relative") {
          // Set your desired location here
          if (window.userLocation) {
            var { latitude, longitude } = window.userLocation;
          } else {
            // Default fallback: Helsinki
            var latitude = 60.1699;
            var longitude = 24.9384;
          }

          const times = SunCalc.getTimes(now, latitude, longitude);
          const sunrise = times.sunrise.getTime();
          const sunset = times.sunset.getTime();
          const nowMs = now.getTime();

          const msInDay = 24 * 60 * 60 * 1000;
          let isDaytime = nowMs >= sunrise && nowMs < sunset;

          let periodStart = isDaytime ? sunrise : sunset;
          let periodEnd = isDaytime ? sunset : sunrise + msInDay; // next sunrise if nighttime
          let periodLength = periodEnd - periodStart;
          let elapsed = (nowMs - periodStart + msInDay) % msInDay;

          let relativeHourLength = periodLength / 12;
          customHour = Math.floor(elapsed / relativeHourLength);
          customMinute = Math.floor(
            (elapsed % relativeHourLength) / (relativeHourLength / 60)
          );
        } else if (mode === "real") {
          // Special handling for 12-hour real time
          customHour = realHours % 12; // Convert 24-hour to 12-hour
          if (customHour === 0) customHour = 12; // Handle midnight/noon (0:00 -> 12:00, 12:00 -> 12:00)
          customMinute = realMinutes;
        } else {
          const secondsInDay = 24 * 60 * 60;
          const nowInSeconds =
            realHours * 3600 + realMinutes * 60 + realSeconds;
          const offset = settings.offset || 0;
          const adjustedSeconds =
            (nowInSeconds - offset + secondsInDay) % secondsInDay;
          const fractionOfDay = adjustedSeconds / secondsInDay;

          const hourCount = settings.hours;
          const minuteCount = settings.minutes;
          const totalMinutes = fractionOfDay * (hourCount * minuteCount);
          customHour = Math.floor(totalMinutes / minuteCount) % hourCount;
          customMinute = Math.floor(totalMinutes % minuteCount);
        }

        // Clock hands
        let minuteAngle, hourAngle;
        if (mode === "relative") {
          minuteAngle = (customMinute / 60) * 360;
          hourAngle = ((customHour + customMinute / 60) / 12) * 360;
        } else {
          const hourCount = settings.hours;
          const minuteCount = settings.minutes;
          minuteAngle = (customMinute / minuteCount) * 360;
          hourAngle =
            ((customHour + customMinute / minuteCount) / hourCount) * 360;
        }

        const setHand = (id, angleDeg, length) => {
          const angleRad = (angleDeg - 90) * (Math.PI / 180);
          const x2 = centerX + length * Math.cos(angleRad);
          const y2 = centerY + length * Math.sin(angleRad);
          const hand = document.getElementById(id);
          hand.setAttribute("x2", x2);
          hand.setAttribute("y2", y2);
        };

        setHand("minuteHand", minuteAngle, 130);
        setHand("hourHand", hourAngle, 100);

        document.getElementById("digital").textContent = `${
          settings.label
        }: ${customHour.toString().padStart(2, "0")}:${customMinute
          .toString()
          .padStart(2, "0")}`;

        if (realHours === 13 && realMinutes === 37 && realSeconds === 0) {
          document.getElementById("sound").play();
          document.getElementById("quote").textContent =
            "ðŸŽ‰ 13:37 Achieved! Stay leet. ðŸŽ‰";
        }
      }

      function updateQuote() {
        const quotes = [
          "All your base are belong to us.",
          "I'm in your clock, showing your time.",
          "Leetness is a mindset.",
          "Hack the planet.",
          "There is no spoon... just time.",
          "Kello 13:37 - aikaa olla leet.",
        ];
        document.getElementById("quote").textContent =
          quotes[Math.floor(Math.random() * quotes.length)];
      }

      function setTheme(isDark) {
        const root = document.documentElement;
        root.style.setProperty("--bg-color", isDark ? "black" : "white");
        root.style.setProperty(
          "--text-color",
          isDark ? "lime" : "var(--text-color-light)"
        );
        localStorage.setItem("leetClockTheme", isDark ? "dark" : "light");
      }

      document.getElementById("toggleTheme").addEventListener("click", () => {
        const currentBg = getComputedStyle(document.documentElement)
          .getPropertyValue("--bg-color")
          .trim();
        const isCurrentlyDark = currentBg === "black";
        setTheme(!isCurrentlyDark);
      });

      document.getElementById("toggleMode").addEventListener("click", () => {
        const modes = Object.keys(modeSettings);
        const currentIndex = modes.indexOf(mode);
        mode = modes[(currentIndex + 1) % modes.length];
        localStorage.setItem("leetClockMode", mode); // ðŸ”’ Save mode
        drawLabels(modeSettings[mode].hours, modeSettings[mode].minutes);
        updateClock();
      });

      const savedMode = localStorage.getItem("leetClockMode");
      if (savedMode && modeSettings[savedMode]) {
        mode = savedMode;
      }
      drawLabels(modeSettings[mode].hours, modeSettings[mode].minutes);

      const savedTheme = localStorage.getItem("leetClockTheme");
      if (savedTheme === "dark" || savedTheme === "light") {
        setTheme(savedTheme === "dark");
      }

      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
          (position) => {
            window.userLocation = {
              latitude: position.coords.latitude,
              longitude: position.coords.longitude,
            };
            // Initial call with updated location
            updateClock();
          },
          (error) => {
            console.warn("Geolocation error:", error);
          }
        );
      } else {
        console.warn("Geolocation not supported.");
      }

      updateQuote();
      setInterval(updateQuote, 3600000);
      setInterval(updateClock, 100);
      updateClock();
      // Load saved location
      const savedLat = localStorage.getItem("latitude");
      const savedLon = localStorage.getItem("longitude");
      if (savedLat && savedLon) {
        window.userLocation = {
          latitude: parseFloat(savedLat),
          longitude: parseFloat(savedLon),
        };
        document.getElementById("latInput").value = savedLat;
        document.getElementById("lonInput").value = savedLon;
      }

      // Handle Set button
      document
        .getElementById("setLocationBtn")
        .addEventListener("click", () => {
          const lat = parseFloat(document.getElementById("latInput").value);
          const lon = parseFloat(document.getElementById("lonInput").value);
          if (!isNaN(lat) && !isNaN(lon)) {
            window.userLocation = { latitude: lat, longitude: lon };
            localStorage.setItem("latitude", lat);
            localStorage.setItem("longitude", lon);
            updateClock(); // refresh with new location
          } else {
            alert("Please enter valid coordinates.");
          }
        });

      document.getElementById("useGeoBtn").addEventListener("click", () => {
        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(
            (position) => {
              const { latitude, longitude } = position.coords;
              window.userLocation = { latitude, longitude };
              document.getElementById("latInput").value = latitude.toFixed(4);
              document.getElementById("lonInput").value = longitude.toFixed(4);
              localStorage.setItem("latitude", latitude);
              localStorage.setItem("longitude", longitude);
              updateClock();
            },
            (error) => alert("Failed to get location: " + error.message)
          );
        } else {
          alert("Geolocation not supported.");
        }
      });

      document.getElementById("citySelect").addEventListener("change", (e) => {
        const val = e.target.value;
        if (val) {
          const [lat, lon] = val.split(",").map(Number);
          document.getElementById("latInput").value = lat;
          document.getElementById("lonInput").value = lon;
          window.userLocation = { latitude: lat, longitude: lon };
          localStorage.setItem("latitude", lat);
          localStorage.setItem("longitude", lon);
          updateClock();
        }
      });
    </script>
  </body>
</html>
