<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Leet Clock</title>
    <style>
      :root {
        --bg-color: black;
        --text-color: lime;
        --text-color-light: #333;
      }
      html {
        font-size: calc(1rem + 1vw); /* Scales with viewport width */
      }

      @media (max-width: 768px) {
        html {
          font-size: calc(0.8rem + 0.4vw); /* Slightly smaller on tablets */
        }
      }

      @media (max-width: 480px) {
        html {
          font-size: calc(0.6rem + 0.3vw); /* Even smaller on mobile */
        }
      }
      body {
        background-color: var(--bg-color);
        color: var(--text-color);
        font-family: monospace;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        margin: 0;
        padding: 2vmin; /* Was 20px */
        box-sizing: border-box;
      }
      svg {
        background-color: transparent;
        width: 70vmin;
        height: 70vmin;
        max-width: 70vmin; /* Was 500px */
        max-height: 70vmin; /* Was 500px */
        min-width: 70vmin; /* Was 350px */
        min-height: 70vmin; /* Was 350px */
      }

      /* For screens smaller than 768px (tablets and mobile) */
      @media (max-width: 768px) {
        svg {
          width: 90vmin;
          height: 90vmin;
          min-width: 40vmin; /* Was 300px */
          min-height: 40vmin; /* Was 300px */
        }
      }

      /* For very small screens (e.g., mobile phones < 480px) */
      @media (max-width: 480px) {
        svg {
          width: 95vmin;
          height: 95vmin;
          min-width: 35vmin; /* Was 250px */
          min-height: 35vmin; /* Was 250px */
        }
      }
      .background {
        position: fixed;
        width: 100%;
        height: 100%;
        top: 0;
        left: 0;
        z-index: -1;
        background: radial-gradient(
          circle,
          rgba(0, 255, 0, 0.2) 0%,
          rgba(0, 0, 0, 1) 100%
        );
        animation: pulse 5s infinite, colorShift 10s infinite;
      }
      @keyframes colorShift {
        0% {
          background: radial-gradient(
            circle,
            rgba(0, 255, 0, 0.2) 0%,
            rgba(0, 0, 0, 1) 100%
          );
        }
        50% {
          background: radial-gradient(
            circle,
            rgba(255, 0, 255, 0.2) 0%,
            rgba(0, 0, 0, 1) 100%
          );
        }
        100% {
          background: radial-gradient(
            circle,
            rgba(0, 255, 0, 0.2) 0%,
            rgba(0, 0, 0, 1) 100%
          );
        }
      }
      @keyframes pulse {
        0% {
          opacity: 0.9;
        }
        50% {
          opacity: 0.5;
        }
        100% {
          opacity: 0.9;
        }
      }
      #quote {
        position: absolute;
        top: 10vh; /* Was 90px */
        width: 100%;
        text-align: center;
        font-size: 0.5rem;
        color: var(--text-color);
      }
      #digital {
        font-size: 1.5rem;
        color: var(--text-color);
        position: absolute;
        top: 1vh;
        left: 50%;
        transform: translateX(-50%);
        text-align: center;
      }
      #toggleTheme,
      #toggleMode,
      #toggleSeconds {
        position: absolute;
        background: none;
        border: 0.1vmin solid var(--text-color); /* Was 1px */
        color: var(--text-color);
        padding: 0.5vmin 1vmin; /* Was 5px 10px */
        font-family: monospace;
        cursor: pointer;
      }

      #toggleTheme {
        right: 1vmin; /* Was 10px */
        top: 1vmin; /* Was 10px */
      }

      #toggleMode {
        left: 1vmin; /* Was 10px */
        top: 1vmin; /* Was 10px */
      }

      #toggleSeconds {
        left: 1vmin; /* Was 10px */
        top: 4vmin; /* Was 40px */
      }
      #startup {
        position: absolute;
        width: 100%;
        height: 100%;
        background-color: black;
        color: lime;
        font-size: 2rem; /* Was 2rem, already good */
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 10;
        animation: fadeOut 1s forwards;
      }
      @keyframes fadeOut {
        0% {
          opacity: 1;
        }
        90% {
          opacity: 1;
        }
        100% {
          opacity: 0;
          visibility: hidden;
        }
      }
      #locationControls {
        position: absolute;
        bottom: 1vh;
        left: 50%;
        transform: translateX(-50%);
        font-family: monospace;
        color: var(--text-color);
        font-size: 1rem;
        display: flex;
        flex-wrap: nowrap;
        gap: 1vmin; /* Was 10px */
        justify-content: center;
        align-items: center;
        background: rgba(0, 0, 0, 0.5);
        padding: 1vmin; /* Was 10px */
        border-radius: 0.5vmin; /* Was 5px */
        max-width: 90%;
        max-height: 10vmin;
      }

      #locationControls label {
        margin-right: 0.5vmin; /* Was 5px */
      }
      #locationControls input::placeholder {
        color: var(--text-color);
        opacity: 0.6;
      }
      #locationControls input,
      #locationControls button {
        background: none;
        border: 0.1vmin solid var(--text-color); /* Was 1px */
        color: var(--text-color);
        padding: 0.4vmin 0.6vmin; /* Was 4px 6px */
        font-family: monospace;
        font-size: 0.9rem;
        width: 20vmin; /* Was 100px */
        box-sizing: border-box;
      }
      #locationControls button:hover {
        background-color: var(--text-color);
        color: var(--bg-color);
        cursor: pointer;
      }
      #locationControls select {
        background: none;
        border: 0.1vmin solid var(--text-color); /* Was 1px */
        color: var(--text-color);
        padding: 0.4vmin 0.6vmin; /* Was 4px 6px */
        font-family: monospace;
        font-size: 0.9rem;
        width: 15vmin; /* Was 150px */
      }
      #locationControls select {
        background: none;
        border: 1px solid var(--text-color);
        color: var(--text-color);
        padding: 4px 6px;
        font-family: monospace;
        font-size: 0.9rem;
        width: 150px;
      }
      #locationControls select option {
        background-color: black;
        color: lime;
      }
      #minuteHand,
      #hourHand,
      #secondHand {
        filter: drop-shadow(0 0 5px var(--text-color));
      }
      #toggleSeconds {
        position: absolute;
        top: 40px;
        left: 10px;
        background: none;
        border: 1px solid var(--text-color);
        color: var(--text-color);
        padding: 5px 10px;
        font-family: monospace;
        cursor: pointer;
      }
      /* For screens smaller than 768px (tablets and mobile) */
      @media (max-width: 768px) {
        svg {
          width: 90vmin;
          height: 90vmin;
          min-width: 40vmin;
          min-height: 40vmin;
        }
        #quote {
          top: 8vh; /* Was 70px */
          font-size: 0.9rem;
        }
        #toggleMode {
          left: 1vmin;
          top: 1vmin;
        }
        #toggleSeconds {
          left: 1vmin;
          top: 3.5vmin; /* Was 35px */
        }
        #toggleTheme {
          right: 1vmin;
          top: 1vmin;
        }
        #digital {
          font-size: 1.2rem;
          bottom: 10vh;
        }
        #locationControls {
          bottom: 1vh;
          font-size: 0.8rem;
          padding: 0.8vmin; /* Was 8px */
          gap: 0.5vmin; /* Was 5px */
        }
        #locationControls input,
        #locationControls button,
        #locationControls select {
          font-size: 0.8rem;
          padding: 0.3vmin 0.5vmin; /* Was 3px 5px */
          width: 8vmin; /* Was 80px */
        }
        #locationControls select {
          width: 12vmin; /* Was 120px */
        }
      }
      /* For very small screens (e.g., mobile phones < 480px) */
      @media (max-width: 480px) {
        svg {
          width: 95vmin;
          height: 95vmin;
          min-width: 35vmin;
          min-height: 35vmin;
        }
        #quote {
          top: 6vh; /* Was 60px */
          font-size: 0.8rem;
        }
        #toggleMode,
        #toggleSeconds,
        #toggleTheme {
          font-size: 0.8rem;
          padding: 0.3vmin 0.6vmin; /* Was 3px 6px */
        }
        #digital {
          font-size: 1rem;
          bottom: 8vh;
        }
        #locationControls {
          bottom: 0.5vh;
          font-size: 0.7rem;
          padding: 0.5vmin; /* Was 5px */
        }
        #locationControls input,
        #locationControls button,
        #locationControls select {
          font-size: 0.7rem;
          padding: 0.2vmin 0.4vmin; /* Was 2px 4px */
          width: 6vmin; /* Was 60px */
        }
        #locationControls select {
          width: 10vmin; /* Was 100px */
        }
      }
    </style>
    <script src="https://unpkg.com/suncalc@1.9.0/suncalc.js"></script>
  </head>
  <body>
    <div id="startup">LOADING . . . 1337 MODE INITIALIZING</div>
    <div class="background"></div>
    <button id="toggleTheme" aria-label="Toggle between dark and light theme">
      Toggle Theme
    </button>
    <button id="toggleMode" aria-label="Switch clock mode"></button>
    <button
      id="toggleSeconds"
      aria-label="Toggle display of seconds in digital clock"
    >
      Show Seconds: OFF
    </button>
    <div id="quote"></div>
    <div id="locationControls">
      <label>Location:</label>
      <select id="citySelect">
        <option value="">-- Choose City --</option>
        <option value="60.1699,24.9384">Helsinki</option>
        <option value="59.3293,18.0686">Stockholm</option>
        <option value="52.5200,13.4050">Berlin</option>
        <option value="51.5074,-0.1278">London</option>
        <option value="40.7128,-74.0060">New York</option>
        <option value="34.0522,-118.2437">Los Angeles</option>
        <option value="35.6895,139.6917">Tokyo</option>
        <option value="-33.8688,151.2093">Sydney</option>
        <option value="5.3453,-4.0244">Abidjan</option>
        <option value="23.0225,72.5714">Ahmedabad</option>
        <option value="31.2001,29.9187">Alexandria</option>
        <option value="13.0827,80.2707">Chennai</option>
        <option value="30.5728,104.0668">Chengdu</option>
        <option value="22.5726,88.3639">Kolkata</option>
        <option value="22.3569,91.7832">Chittagong</option>
        <option value="29.4316,106.9123">Chongqing</option>
        <option value="-6.7924,39.2083">Dar es Salaam</option>
        <option value="28.7041,77.1025">Delhi</option>
        <option value="23.0205,113.7518">Dongguan</option>
        <option value="9.0300,38.7400">Addis Ababa</option>
        <option value="39.9042,116.4074">Beijing</option>
        <option value="-19.9167,-43.9345">Belo Horizonte</option>
        <option value="4.7110,-74.0721">Bogotá</option>
        <option value="41.3851,2.1734">Barcelona</option>
        <option value="-34.6037,-58.3816">Buenos Aires</option>
        <option value="30.0444,31.2357">Cairo</option>
        <option value="34.3416,108.9398">Xi'an</option>
        <option value="12.9716,77.5946">Bangalore</option>
        <option value="39.3434,117.3616">Tianjin</option>
        <option value="18.5204,73.8567">Pune</option>
        <option value="55.7558,37.6173">Moscow</option>
        <option value="19.4326,-99.1332">Mexico City</option>
        <option value="19.0760,72.8777">Mumbai</option>
        <option value="37.5665,126.9780">Seoul</option>
        <option value="35.6895,139.6917">Tokyo</option>
        <option value="23.1291,113.2644">Guangzhou</option>
        <option value="20.6597,-103.3496">Guadalajara</option>
        <option value="30.2741,120.1551">Hangzhou</option>
        <option value="17.3850,78.4867">Hyderabad</option>
        <option value="13.7563,100.5018">Bangkok</option>
        <option value="-6.2088,106.8456">Jakarta</option>
        <option value="36.0662,120.3826">Qingdao</option>
        <option value="6.5244,3.3792">Lagos</option>
        <option value="34.6937,135.5023">Osaka</option>
        <option value="-33.4489,-70.6693">Santiago</option>
        <option value="-23.5505,-46.6333">São Paulo</option>
        <option value="24.8607,67.0011">Karachi</option>
        <option value="24.7136,46.6753">Riyadh</option>
        <option value="40.7128,-74.0060">New York City</option>
        <option value="13.0827,80.2707">Chennai</option>
        <option value="22.3193,114.1694">Hong Kong</option>
        <option value="23.0215,113.7490">Foshan</option>
        <option value="-33.8688,151.2093">Sydney</option>
        <option value="21.1702,72.8311">Surat</option>
        <option value="35.6892,51.3890">Tehran</option>
        <option value="10.7769,106.7009">Ho Chi Minh City</option>
        <option value="51.5074,-0.1278">London</option>
      </select>
      <input type="number" id="latInput" placeholder="Latitude" step="0.1" />
      <input type="number" id="lonInput" placeholder="Longitude" step="0.1" />
      <button id="setLocationBtn" aria-label="Set custom location">Set</button>
      <button id="useGeoBtn" aria-label="Use my current location">
        Use My Location
      </button>
      <button id="resetLocationBtn" aria-label="Reset location to default">
        Reset Location
      </button>
    </div>
    <svg id="leetClock" viewBox="0 0 400 400">
      <circle
        cx="200"
        cy="200"
        r="180"
        stroke="lime"
        stroke-width="4"
        fill="none"
      />
      <g
        id="labels"
        fill="lime"
        font-family="monospace"
        text-anchor="middle"
        dominant-baseline="middle"
      ></g>
      <line
        id="minuteHand"
        x1="200"
        y1="200"
        x2="200"
        y2="50"
        stroke="lime"
        stroke-width="3"
      />
      <line
        id="hourHand"
        x1="200"
        y1="200"
        x2="200"
        y2="100"
        stroke="lime"
        stroke-width="6"
      />
      <line
        id="secondHand"
        x1="200"
        y1="200"
        x2="200"
        y2="30"
        stroke="lime"
        stroke-width="1"
      />
      <circle cx="200" cy="200" r="10" fill="lime" />
    </svg>
    <div id="digital"></div>
    <audio id="sound"></audio>
    <script>
      let showSeconds = false; // Default to not showing seconds
      const centerX = 200;
      const centerY = 200;
      let mode = "leet";

      const modeSettings = {
        leet: {
          hours: 13,
          minutes: 37,
          label: "Leet time",
          offset: 13 * 3600 + 37 * 60,
          hourFont: 24, // 6% of viewBox width (24/400)
          minuteFont: 12, // 2% of viewBox width (8/400)
        },
        real: {
          hours: 12,
          minutes: 60,
          label: "Real time 12h",
          hourFont: 24, // 6% of viewBox width (24/400)
          minuteFont: 12, // 2.5% of viewBox width (10/400)
        },
        real24: {
          hours: 24,
          minutes: 60,
          label: "Real time 24h",
          hourFont: 24, // 4.5% of viewBox width (18/400)
          minuteFont: 12, // 2.5% of viewBox width (10/400)
        },
        sata: {
          hours: 100,
          minutes: 100,
          label: "Sata time",
          hourFont: 8, // 2% of viewBox width (8/400)
          minuteFont: 8, // 2% of viewBox width (8/400)
        },
        relative: {
          hours: 12,
          minutes: 60,
          label: "Relative Hour",
          hourFont: 24, // 6% of viewBox width (24/400)
          minuteFont: 12, // 2.5% of viewBox width (10/400)
        },
      };

      const labelGroup = document.getElementById("labels");

      function drawLabels(hourCount, minuteCount) {
        labelGroup.innerHTML = "";
        const hourRadius = 35; // 35% of viewBox width (150/400)
        const minuteRadius = 42.5; // 42.5% of viewBox width (170/400)
        const settings = modeSettings[mode];
        for (let i = 0; i < hourCount; i++) {
          const angle = ((360 / hourCount) * i - 90) * (Math.PI / 180);
          const x = centerX + (hourRadius / 100) * 400 * Math.cos(angle);
          const y = centerY + (hourRadius / 100) * 400 * Math.sin(angle);
          const text = document.createElementNS(
            "http://www.w3.org/2000/svg",
            "text"
          );
          text.setAttribute("x", x);
          text.setAttribute("y", y);
          text.setAttribute("font-size", settings.hourFont); // Will update this next
          text.textContent = i.toString();
          labelGroup.appendChild(text);
        }
        for (let i = 0; i < minuteCount; i++) {
          const angle = ((360 / minuteCount) * i - 90) * (Math.PI / 180);
          const x = centerX + (minuteRadius / 100) * 400 * Math.cos(angle);
          const y = centerY + (minuteRadius / 100) * 400 * Math.sin(angle);
          const text = document.createElementNS(
            "http://www.w3.org/2000/svg",
            "text"
          );
          text.setAttribute("x", x);
          text.setAttribute("y", y);
          text.setAttribute("font-size", settings.minuteFont); // Will update this next
          text.textContent = i.toString();
          labelGroup.appendChild(text);
        }
      }

      function getSunriseTime(date) {
        const times = SunCalc.getTimes(date, latitude, longitude);
        return times.sunrise;
      }

      function getSunsetTime(date) {
        const times = SunCalc.getTimes(date, latitude, longitude);
        return times.sunset;
      }

      function updateClock() {
        const now = new Date();
        const realHours = now.getHours();
        const realMinutes = now.getMinutes();
        const realSeconds = now.getSeconds();
        const realMilliseconds = now.getMilliseconds();

        const nowInSeconds =
          realHours * 3600 +
          realMinutes * 60 +
          realSeconds +
          realMilliseconds / 1000;

        let customHour, customMinute, customSecond;
        const settings = modeSettings[mode];

        if (mode === "relative") {
          if (window.userLocation) {
            var { latitude, longitude } = window.userLocation;
          } else {
            var latitude = 60.1699;
            var longitude = 24.9384;
          }

          const times = SunCalc.getTimes(now, latitude, longitude);
          const sunrise = times.sunrise.getTime();
          const sunset = times.sunset.getTime();
          const nowMs = now.getTime();

          const msInDay = 24 * 60 * 60 * 1000;
          let isDaytime = nowMs >= sunrise && nowMs < sunset;

          let periodStart = isDaytime ? sunrise : sunset;
          let periodEnd = isDaytime ? sunset : sunrise + msInDay;
          let periodLength = periodEnd - periodStart;
          let elapsed = (nowMs - periodStart + msInDay) % msInDay;

          let relativeHourLength = periodLength / 12;
          customHour = Math.floor(elapsed / relativeHourLength);
          customMinute = Math.floor(
            (elapsed % relativeHourLength) / (relativeHourLength / 60)
          );
          customSecond = Math.floor(
            (elapsed % (relativeHourLength / 60)) / (relativeHourLength / 3600)
          );
        } else if (mode === "real") {
          customHour = realHours % 12;
          if (customHour === 0) customHour = 12;
          customMinute = realMinutes;
          customSecond = realSeconds;
        } else if (mode === "real24") {
          customHour = realHours;
          customMinute = realMinutes;
          customSecond = realSeconds;
        } else {
          const secondsInDay = 24 * 60 * 60;
          const offset = settings.offset || 0;
          const adjustedSeconds =
            (nowInSeconds - offset + secondsInDay) % secondsInDay;
          const fractionOfDay = adjustedSeconds / secondsInDay;

          const hourCount = settings.hours;
          const minuteCount = settings.minutes;
          const secondCount = mode === "sata" ? 100 : mode === "leet" ? 37 : 60;
          const totalCustomSeconds = hourCount * minuteCount * secondCount;

          const totalMinutes = fractionOfDay * (hourCount * minuteCount);
          customHour = Math.floor(totalMinutes / minuteCount) % hourCount;
          customMinute = Math.floor(totalMinutes % minuteCount);
          const totalSeconds = fractionOfDay * totalCustomSeconds;
          customSecond = Math.floor(totalSeconds % secondCount);
        }

        let minuteAngle, hourAngle, secondAngle;
        if (mode === "relative") {
          minuteAngle = (customMinute / 60) * 360;
          hourAngle = ((customHour + customMinute / 60) / 12) * 360;
          secondAngle = (customSecond / 60) * 360;
        } else {
          const hourCount = settings.hours;
          const minuteCount = settings.minutes;
          const secondCount = mode === "sata" ? 100 : mode === "leet" ? 37 : 60;
          minuteAngle = (customMinute / minuteCount) * 360;
          hourAngle =
            ((customHour + customMinute / minuteCount) / hourCount) * 360;
          secondAngle = (customSecond / secondCount) * 360;
        }

        const setHand = (id, angleDeg, lengthPercentage) => {
          const length = (lengthPercentage / 100) * 400; // Convert percentage to viewBox units (400 is the viewBox width)
          const angleRad = (angleDeg - 90) * (Math.PI / 180);
          const x2 = centerX + length * Math.cos(angleRad);
          const y2 = centerY + length * Math.sin(angleRad);
          const hand = document.getElementById(id);
          hand.setAttribute("x2", x2);
          hand.setAttribute("y2", y2);
        };

        // Update stroke widths dynamically based on viewBox units
        document
          .getElementById("minuteHand")
          .setAttribute("stroke-width", (0.75 / 100) * 400); // 0.75% of 400
        document
          .getElementById("hourHand")
          .setAttribute("stroke-width", (1.5 / 100) * 400); // 1.5% of 400
        document
          .getElementById("secondHand")
          .setAttribute("stroke-width", (0.25 / 100) * 400); // 0.25% of 400
        document
          .querySelector("svg circle[stroke='lime']")
          .setAttribute("stroke-width", (1 / 100) * 400); // 1% of 400
        document
          .querySelector("svg circle[fill='lime']")
          .setAttribute("r", (2.5 / 100) * 400); // 2.5% of 400

        setHand("hourHand", hourAngle, 25); // 25% of viewBox width
        setHand("minuteHand", minuteAngle, 36); // 37.5% of viewBox width
        setHand("secondHand", secondAngle, 40); // 42.5% of viewBox width

        document.getElementById("digital").textContent = `${
          settings.label
        }: ${customHour.toString().padStart(2, "0")}:${customMinute
          .toString()
          .padStart(2, "0")}${
          showSeconds ? `:${customSecond.toString().padStart(2, "0")}` : ""
        }${
          (mode === "real" || mode === "relative") && !showSeconds
            ? realHours >= 12
              ? " PM"
              : " AM"
            : ""
        }`;

        if (realHours === 13 && realMinutes === 37 && realSeconds === 0) {
          const sound = document.getElementById("sound");
          if (!sound.src) {
            sound.src = "leet.wav";
          }
          sound.play();
          document.getElementById("quote").textContent =
            "🎉 13:37 Achieved! Stay leet. 🎉";
        }
      }

      function updateQuote() {
        const quotes = [
          "All your base are belong to us.",
          "I'm in your clock, showing your time.",
          "Leetness is a mindset.",
          "Hack the planet.",
          "There is no spoon... just time.",
          "Kello 13:37 - aikaa olla leet.",
        ];
        document.getElementById("quote").textContent =
          quotes[Math.floor(Math.random() * quotes.length)];
      }

      function setTheme(isDark) {
        const root = document.documentElement;
        root.style.setProperty("--bg-color", isDark ? "black" : "white");
        root.style.setProperty(
          "--text-color",
          isDark ? "lime" : "var(--text-color-light)"
        );
        localStorage.setItem("leetClockTheme", isDark ? "dark" : "light");
      }

      document.getElementById("toggleTheme").addEventListener("click", () => {
        const currentBg = getComputedStyle(document.documentElement)
          .getPropertyValue("--bg-color")
          .trim();
        const isCurrentlyDark = currentBg === "black";
        setTheme(!isCurrentlyDark);
      });

      document.getElementById("toggleMode").addEventListener("click", () => {
        const modes = Object.keys(modeSettings);
        const currentIndex = modes.indexOf(mode);
        mode = modes[(currentIndex + 1) % modes.length];
        localStorage.setItem("leetClockMode", mode);
        drawLabels(modeSettings[mode].hours, modeSettings[mode].minutes);
        document.getElementById(
          "toggleMode"
        ).textContent = `Mode: ${modeSettings[mode].label}`;
        updateClock();
      });

      document.getElementById("toggleSeconds").addEventListener("click", () => {
        showSeconds = !showSeconds;
        document.getElementById("toggleSeconds").textContent = `Show Seconds: ${
          showSeconds ? "ON" : "OFF"
        }`;
        localStorage.setItem("showSeconds", showSeconds.toString());
        updateClock(); // Refresh the display
      });

      // Load saved setting
      const savedShowSeconds = localStorage.getItem("showSeconds");
      if (savedShowSeconds) {
        showSeconds = savedShowSeconds === "true";
        document.getElementById("toggleSeconds").textContent = `Show Seconds: ${
          showSeconds ? "ON" : "OFF"
        }`;
      }

      // Load the saved mode and update the button text
      const savedMode = localStorage.getItem("leetClockMode");
      if (savedMode && modeSettings[savedMode]) {
        mode = savedMode;
      }
      drawLabels(modeSettings[mode].hours, modeSettings[mode].minutes);
      document.getElementById(
        "toggleMode"
      ).textContent = `Mode: ${modeSettings[mode].label}`; // Add this line to update the button text

      const savedTheme = localStorage.getItem("leetClockTheme");
      if (savedTheme === "dark" || savedTheme === "light") {
        setTheme(savedTheme === "dark");
      }

      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
          (position) => {
            window.userLocation = {
              latitude: position.coords.latitude,
              longitude: position.coords.longitude,
            };
            updateClock();
          },
          (error) => {
            console.warn("Geolocation error:", error);
          }
        );
      } else {
        console.warn("Geolocation not supported.");
      }

      updateQuote();
      setInterval(updateQuote, 3600000);
      setInterval(updateClock, 10);
      updateClock();

      const savedLat = localStorage.getItem("latitude");
      const savedLon = localStorage.getItem("longitude");
      if (savedLat && savedLon) {
        window.userLocation = {
          latitude: parseFloat(savedLat),
          longitude: parseFloat(savedLon),
        };
        document.getElementById("latInput").value = savedLat;
        document.getElementById("lonInput").value = savedLon;
      }

      document
        .getElementById("setLocationBtn")
        .addEventListener("click", () => {
          const lat = parseFloat(document.getElementById("latInput").value);
          const lon = parseFloat(document.getElementById("lonInput").value);
          if (!isNaN(lat) && !isNaN(lon)) {
            window.userLocation = { latitude: lat, longitude: lon };
            localStorage.setItem("latitude", lat);
            localStorage.setItem("longitude", lon);
            updateClock();
          } else {
            alert("Please enter valid coordinates.");
          }
        });

      document.getElementById("useGeoBtn").addEventListener("click", () => {
        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(
            (position) => {
              const { latitude, longitude } = position.coords;
              window.userLocation = { latitude, longitude };
              document.getElementById("latInput").value = latitude.toFixed(4);
              document.getElementById("lonInput").value = longitude.toFixed(4);
              localStorage.setItem("latitude", latitude);
              localStorage.setItem("longitude", longitude);
              updateClock();
            },
            (error) => alert("Failed to get location: " + error.message)
          );
        } else {
          alert("Geolocation not supported.");
        }
      });

      document.getElementById("citySelect").addEventListener("change", (e) => {
        const val = e.target.value;
        if (val) {
          const [lat, lon] = val.split(",").map(Number);
          document.getElementById("latInput").value = lat;
          document.getElementById("lonInput").value = lon;
          window.userLocation = { latitude: lat, longitude: lon };
          localStorage.setItem("latitude", lat);
          localStorage.setItem("longitude", lon);
          updateClock();
        }
      });

      document
        .getElementById("resetLocationBtn")
        .addEventListener("click", () => {
          window.userLocation = { latitude: 60.1699, longitude: 24.9384 };
          localStorage.removeItem("latitude");
          localStorage.removeItem("longitude");
          document.getElementById("latInput").value = "";
          document.getElementById("lonInput").value = "";
          document.getElementById("citySelect").value = "";
          updateClock();
        });
    </script>
  </body>
</html>
