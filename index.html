<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Leet Clock</title>
    <link rel="stylesheet" href="styles.css" />
    <script src="https://unpkg.com/suncalc@1.9.0/suncalc.js"></script>
  </head>
  <body>
    <div id="startup">LOADING . . . 1337 MODE INITIALIZING</div>
    <div class="background"></div>
    <button id="toggleTheme" aria-label="Toggle between dark and light theme">
      Toggle Theme
    </button>
    <button id="toggleMode" aria-label="Switch clock mode"></button>
    <button
      id="toggleSeconds"
      aria-label="Toggle display of seconds in digital clock"
    >
      Show Seconds: OFF
    </button>
    <div id="quote"></div>
    <div id="locationControls">
      <label>Location:</label>
      <select id="citySelect">
        <option value="">-- Choose City --</option>
        <option value="60.1699,24.9384">Helsinki</option>
        <option value="59.3293,18.0686">Stockholm</option>
        <option value="52.5200,13.4050">Berlin</option>
        <option value="51.5074,-0.1278">London</option>
        <option value="40.7128,-74.0060">New York</option>
        <option value="34.0522,-118.2437">Los Angeles</option>
        <option value="35.6895,139.6917">Tokyo</option>
        <option value="-33.8688,151.2093">Sydney</option>
        <option value="5.3453,-4.0244">Abidjan</option>
        <option value="23.0225,72.5714">Ahmedabad</option>
        <option value="31.2001,29.9187">Alexandria</option>
        <option value="13.0827,80.2707">Chennai</option>
        <option value="30.5728,104.0668">Chengdu</option>
        <option value="22.5726,88.3639">Kolkata</option>
        <option value="22.3569,91.7832">Chittagong</option>
        <option value="29.4316,106.9123">Chongqing</option>
        <option value="-6.7924,39.2083">Dar es Salaam</option>
        <option value="28.7041,77.1025">Delhi</option>
        <option value="23.0205,113.7518">Dongguan</option>
        <option value="9.0300,38.7400">Addis Ababa</option>
        <option value="39.9042,116.4074">Beijing</option>
        <option value="-19.9167,-43.9345">Belo Horizonte</option>
        <option value="4.7110,-74.0721">Bogotá</option>
        <option value="41.3851,2.1734">Barcelona</option>
        <option value="-34.6037,-58.3816">Buenos Aires</option>
        <option value="30.0444,31.2357">Cairo</option>
        <option value="34.3416,108.9398">Xi'an</option>
        <option value="12.9716,77.5946">Bangalore</option>
        <option value="39.3434,117.3616">Tianjin</option>
        <option value="18.5204,73.8567">Pune</option>
        <option value="55.7558,37.6173">Moscow</option>
        <option value="19.4326,-99.1332">Mexico City</option>
        <option value="19.0760,72.8777">Mumbai</option>
        <option value="37.5665,126.9780">Seoul</option>
        <option value="35.6895,139.6917">Tokyo</option>
        <option value="23.1291,113.2644">Guangzhou</option>
        <option value="20.6597,-103.3496">Guadalajara</option>
        <option value="30.2741,120.1551">Hangzhou</option>
        <option value="17.3850,78.4867">Hyderabad</option>
        <option value="13.7563,100.5018">Bangkok</option>
        <option value="-6.2088,106.8456">Jakarta</option>
        <option value="36.0662,120.3826">Qingdao</option>
        <option value="6.5244,3.3792">Lagos</option>
        <option value="34.6937,135.5023">Osaka</option>
        <option value="-33.4489,-70.6693">Santiago</option>
        <option value="-23.5505,-46.6333">São Paulo</option>
        <option value="24.8607,67.0011">Karachi</option>
        <option value="24.7136,46.6753">Riyadh</option>
        <option value="40.7128,-74.0060">New York City</option>
        <option value="13.0827,80.2707">Chennai</option>
        <option value="22.3193,114.1694">Hong Kong</option>
        <option value="23.0215,113.7490">Foshan</option>
        <option value="-33.8688,151.2093">Sydney</option>
        <option value="21.1702,72.8311">Surat</option>
        <option value="35.6892,51.3890">Tehran</option>
        <option value="10.7769,106.7009">Ho Chi Minh City</option>
        <option value="51.5074,-0.1278">London</option>
      </select>
      <input type="number" id="latInput" placeholder="Latitude" step="0.1" />
      <input type="number" id="lonInput" placeholder="Longitude" step="0.1" />
      <button id="setLocationBtn" aria-label="Set custom location">Set</button>
      <button id="useGeoBtn" aria-label="Use my current location">
        Use My Location
      </button>
      <button id="resetLocationBtn" aria-label="Reset location to default">
        Reset Location
      </button>
    </div>
    <svg id="leetClock" viewBox="0 0 400 400">
      <circle
        cx="200"
        cy="200"
        r="180"
        stroke="lime"
        stroke-width="4"
        fill="none"
      />
      <g
        id="labels"
        fill="lime"
        font-family="monospace"
        text-anchor="middle"
        dominant-baseline="middle"
      ></g>
      <line
        id="minuteHand"
        x1="200"
        y1="200"
        x2="200"
        y2="50"
        stroke="lime"
        stroke-width="3"
      />
      <line
        id="hourHand"
        x1="200"
        y1="200"
        x2="200"
        y2="100"
        stroke="lime"
        stroke-width="6"
      />
      <line
        id="secondHand"
        x1="200"
        y1="200"
        x2="200"
        y2="30"
        stroke="lime"
        stroke-width="1"
      />
      <circle cx="200" cy="200" r="10" fill="lime" />
    </svg>
    <div id="digital"></div>
    <audio id="sound"></audio>
    <script>
      let showSeconds = false; // Default to not showing seconds
      const centerX = 200;
      const centerY = 200;
      let mode = "leet";

      const modeSettings = {
        leet: {
          hours: 13,
          minutes: 37,
          label: "Leet time",
          offset: 13 * 3600 + 37 * 60,
          hourFont: 24, // 6% of viewBox width (24/400)
          minuteFont: 12, // 2% of viewBox width (8/400)
        },
        real: {
          hours: 12,
          minutes: 60,
          label: "Real time 12h",
          hourFont: 24, // 6% of viewBox width (24/400)
          minuteFont: 12, // 2.5% of viewBox width (10/400)
        },
        real24: {
          hours: 24,
          minutes: 60,
          label: "Real time 24h",
          hourFont: 24, // 4.5% of viewBox width (18/400)
          minuteFont: 12, // 2.5% of viewBox width (10/400)
        },
        sata: {
          hours: 100,
          minutes: 100,
          label: "Sata time",
          hourFont: 6, // 2% of viewBox width (8/400)
          minuteFont: 8, // 2% of viewBox width (8/400)
        },
        relative: {
          hours: 12,
          minutes: 60,
          label: "Relative Hour",
          hourFont: 24, // 6% of viewBox width (24/400)
          minuteFont: 12, // 2.5% of viewBox width (10/400)
        },
        binary: {
          hours: 16,
          minutes: 64,
          label: "Binary time",
          hourFont: 24, // Slightly smaller due to 16 hours
          minuteFont: 12, // Smaller due to 64 minutes
        },
        martian: {
          hours: 24,
          minutes: 60,
          label: "Martian time",
          hourFont: 24,
          minuteFont: 12,
        },
        hex: {
          hours: 16,
          minutes: 16,
          label: "Hex time",
          hourFont: 24, // 16 hours
          minuteFont: 12, // Only 16 minutes, can be larger
        },
      };

      const labelGroup = document.getElementById("labels");

      function drawLabels(hourCount, minuteCount) {
        labelGroup.innerHTML = "";
        const hourRadius = 30;
        const minuteRadius = 40;
        const settings = modeSettings[mode];
        const isHexMode = mode === "hex";

        // Function to convert numbers to hexadecimal for hex mode
        const toHexLabel = (num) =>
          isHexMode ? num.toString(16).toUpperCase() : num.toString();

        for (let i = 0; i < hourCount; i++) {
          const angle = ((360 / hourCount) * i - 90) * (Math.PI / 180);
          const x = centerX + (hourRadius / 100) * 400 * Math.cos(angle);
          const y = centerY + (hourRadius / 100) * 400 * Math.sin(angle);
          const text = document.createElementNS(
            "http://www.w3.org/2000/svg",
            "text"
          );
          text.setAttribute("x", x);
          text.setAttribute("y", y);
          text.setAttribute("font-size", settings.hourFont);
          text.textContent = toHexLabel(i);
          labelGroup.appendChild(text);
        }
        for (let i = 0; i < minuteCount; i++) {
          const angle = ((360 / minuteCount) * i - 90) * (Math.PI / 180);
          const x = centerX + (minuteRadius / 100) * 400 * Math.cos(angle);
          const y = centerY + (minuteRadius / 100) * 400 * Math.sin(angle);
          const text = document.createElementNS(
            "http://www.w3.org/2000/svg",
            "text"
          );
          text.setAttribute("x", x);
          text.setAttribute("y", y);
          text.setAttribute("font-size", settings.minuteFont);
          text.textContent = toHexLabel(i);
          labelGroup.appendChild(text);
        }
      }

      function getSunriseTime(date) {
        const times = SunCalc.getTimes(date, latitude, longitude);
        return times.sunrise;
      }

      function getSunsetTime(date) {
        const times = SunCalc.getTimes(date, latitude, longitude);
        return times.sunset;
      }

      function updateClock() {
        const now = new Date();
        const realHours = now.getHours();
        const realMinutes = now.getMinutes();
        const realSeconds = now.getSeconds();
        const realMilliseconds = now.getMilliseconds();

        const nowInSeconds =
          realHours * 3600 +
          realMinutes * 60 +
          realSeconds +
          realMilliseconds / 1000;

        let customHour, customMinute, customSecond;
        const settings = modeSettings[mode];

        if (mode === "relative") {
          if (window.userLocation) {
            var { latitude, longitude } = window.userLocation;
          } else {
            var latitude = 60.1699;
            var longitude = 24.9384;
          }

          const times = SunCalc.getTimes(now, latitude, longitude);
          const sunrise = times.sunrise.getTime();
          const sunset = times.sunset.getTime();
          const nowMs = now.getTime();

          const msInDay = 24 * 60 * 60 * 1000;
          let isDaytime = nowMs >= sunrise && nowMs < sunset;

          let periodStart = isDaytime ? sunrise : sunset;
          let periodEnd = isDaytime ? sunset : sunrise + msInDay;
          let periodLength = periodEnd - periodStart;
          let elapsed = (nowMs - periodStart + msInDay) % msInDay;

          let relativeHourLength = periodLength / 12;
          customHour = Math.floor(elapsed / relativeHourLength);
          customMinute = Math.floor(
            (elapsed % relativeHourLength) / (relativeHourLength / 60)
          );
          customSecond = Math.floor(
            (elapsed % (relativeHourLength / 60)) / (relativeHourLength / 3600)
          );
        } else if (mode === "real") {
          customHour = realHours % 12;
          if (customHour === 0) customHour = 12;
          customMinute = realMinutes;
          customSecond = realSeconds;
        } else if (mode === "real24") {
          customHour = realHours;
          customMinute = realMinutes;
          customSecond = realSeconds;
        } else if (mode === "martian") {
          // Martian day (sol) is 88,775 seconds
          const secondsInEarthDay = 24 * 60 * 60; // 86,400 seconds
          const secondsInMartianDay = 88775;
          const fractionOfEarthDay = nowInSeconds / secondsInEarthDay;
          const martianSeconds = fractionOfEarthDay * secondsInMartianDay;

          const hourCount = settings.hours; // 24
          const minuteCount = settings.minutes; // 60
          const secondCount = 60;
          const totalMartianSeconds = hourCount * minuteCount * secondCount;

          const totalMinutes = martianSeconds / (secondCount * minuteCount);
          customHour = Math.floor(totalMinutes / minuteCount) % hourCount;
          customMinute = Math.floor(totalMinutes % minuteCount);
          customSecond = Math.floor(
            (martianSeconds % (secondCount * minuteCount)) / secondCount
          );
        } else {
          const secondsInDay = 24 * 60 * 60;
          const offset = settings.offset || 0;
          const adjustedSeconds =
            (nowInSeconds - offset + secondsInDay) % secondsInDay;
          const fractionOfDay = adjustedSeconds / secondsInDay;

          const hourCount = settings.hours;
          const minuteCount = settings.minutes;
          const secondCount =
            mode === "sata"
              ? 100
              : mode === "leet"
              ? 37
              : mode === "binary"
              ? 64
              : mode === "hex"
              ? 16
              : 60;
          const totalCustomSeconds = hourCount * minuteCount * secondCount;

          const totalMinutes = fractionOfDay * (hourCount * minuteCount);
          customHour = Math.floor(totalMinutes / minuteCount) % hourCount;
          customMinute = Math.floor(totalMinutes % minuteCount);
          const totalSeconds = fractionOfDay * totalCustomSeconds;
          customSecond = Math.floor(totalSeconds % secondCount);
        }

        let minuteAngle, hourAngle, secondAngle;
        if (mode === "relative") {
          minuteAngle = (customMinute / 60) * 360;
          hourAngle = ((customHour + customMinute / 60) / 12) * 360;
          secondAngle = (customSecond / 60) * 360;
        } else {
          const hourCount = settings.hours;
          const minuteCount = settings.minutes;
          const secondCount =
            mode === "sata"
              ? 100
              : mode === "leet"
              ? 37
              : mode === "binary"
              ? 64
              : mode === "hex"
              ? 16
              : 60;
          minuteAngle = (customMinute / minuteCount) * 360;
          hourAngle =
            ((customHour + customMinute / minuteCount) / hourCount) * 360;
          secondAngle = (customSecond / secondCount) * 360;
        }

        const setHand = (id, angleDeg, lengthPercentage) => {
          const length = (lengthPercentage / 100) * 400;
          const angleRad = (angleDeg - 90) * (Math.PI / 180);
          const x2 = centerX + length * Math.cos(angleRad);
          const y2 = centerY + length * Math.sin(angleRad);
          const hand = document.getElementById(id);
          hand.setAttribute("x2", x2);
          hand.setAttribute("y2", y2);
        };

        document
          .getElementById("minuteHand")
          .setAttribute("stroke-width", (0.75 / 100) * 400);
        document
          .getElementById("hourHand")
          .setAttribute("stroke-width", (1.5 / 100) * 400);
        document
          .getElementById("secondHand")
          .setAttribute("stroke-width", (0.25 / 100) * 400);
        document
          .querySelector("svg circle[stroke='lime']")
          .setAttribute("stroke-width", (1 / 100) * 400);
        document
          .querySelector("svg circle[fill='lime']")
          .setAttribute("r", (2.5 / 100) * 400);

        setHand("minuteHand", minuteAngle, 37.5);
        setHand("hourHand", hourAngle, 25);
        setHand("secondHand", secondAngle, 42.5);

        // Update the digital label with hexadecimal for hex mode
        const toHex = (num) =>
          mode === "hex" ? num.toString(16).toUpperCase() : num.toString();
        document.getElementById("digital").textContent = `${
          settings.label
        }: ${toHex(customHour).padStart(2, "0")}:${toHex(customMinute).padStart(
          2,
          "0"
        )}${showSeconds ? `:${toHex(customSecond).padStart(2, "0")}` : ""}${
          (mode === "real" || mode === "relative") && !showSeconds
            ? realHours >= 12
              ? " PM"
              : " AM"
            : ""
        }`;

        if (realHours === 13 && realMinutes === 37 && realSeconds === 0) {
          const sound = document.getElementById("sound");
          if (!sound.src) {
            sound.src = "leet.wav";
          }
          sound.play();
          document.getElementById("quote").textContent =
            "🎉 13:37 Achieved! Stay leet. 🎉";
        }
        // Reapply visual effects to ensure they persist after updates
        applyVisualEffects(mode);
      }

      function updateQuote() {
        const quotes = [
          "All your base are belong to us.",
          "I'm in your clock, showing your time.",
          "Leetness is a mindset.",
          "Hack the planet.",
          "There is no spoon... just time.",
          "Kello 13:37 - aikaa olla leet.",
        ];
        document.getElementById("quote").textContent =
          quotes[Math.floor(Math.random() * quotes.length)];
      }

      function setTheme(isDark) {
        const root = document.documentElement;
        root.style.setProperty("--bg-color", isDark ? "black" : "white");
        root.style.setProperty(
          "--text-color",
          isDark ? "lime" : "var(--text-color-light)"
        );
        localStorage.setItem("leetClockTheme", isDark ? "dark" : "light");
      }

      function applyVisualEffects(currentMode) {
        // Elements to apply effects to
        const clockElements = [
          document.querySelector("svg circle[stroke='lime']"), // Outer circle
          document.getElementById("minuteHand"),
          document.getElementById("hourHand"),
          document.getElementById("secondHand"),
          document.querySelector("svg circle[fill='lime']"), // Center circle
          ...document.querySelectorAll("svg text[fill='lime']"), // Labels
        ];

        // Remove all previous effects
        clockElements.forEach((el) => {
          if (el) {
            el.classList.remove("martian-glow", "binary-pulse", "hex-cyan");
          }
        });
        document.body.classList.remove("martian-background");

        // Apply effects based on the current mode
        if (currentMode === "martian") {
          clockElements.forEach((el) => {
            if (el) el.classList.add("martian-glow");
          });
          document.body.classList.add("martian-background");
        } else if (currentMode === "binary") {
          clockElements.forEach((el) => {
            if (el) el.classList.add("binary-pulse");
          });
        } else if (currentMode === "hex") {
          clockElements.forEach((el) => {
            if (el) el.classList.add("hex-cyan");
          });
        }
      }

      document.getElementById("toggleTheme").addEventListener("click", () => {
        const currentBg = getComputedStyle(document.documentElement)
          .getPropertyValue("--bg-color")
          .trim();
        const isCurrentlyDark = currentBg === "black";
        setTheme(!isCurrentlyDark);
      });

      document.getElementById("toggleMode").addEventListener("click", () => {
        const modes = Object.keys(modeSettings);
        const currentIndex = modes.indexOf(mode);
        mode = modes[(currentIndex + 1) % modes.length];
        localStorage.setItem("leetClockMode", mode);
        drawLabels(modeSettings[mode].hours, modeSettings[mode].minutes);
        document.getElementById(
          "toggleMode"
        ).textContent = `Mode: ${modeSettings[mode].label}`;
        applyVisualEffects(mode); // Apply visual effects on mode change
        updateClock();
      });

      document.getElementById("toggleSeconds").addEventListener("click", () => {
        showSeconds = !showSeconds;
        document.getElementById("toggleSeconds").textContent = `Show Seconds: ${
          showSeconds ? "ON" : "OFF"
        }`;
        localStorage.setItem("showSeconds", showSeconds.toString());
        updateClock(); // Refresh the display
      });

      // Load saved setting for ShowSeconds
      const savedShowSeconds = localStorage.getItem("showSeconds");
      if (savedShowSeconds) {
        showSeconds = savedShowSeconds === "true";
        document.getElementById("toggleSeconds").textContent = `Show Seconds: ${
          showSeconds ? "ON" : "OFF"
        }`;
      }

      // Load the saved mode and update the button text
      const savedMode = localStorage.getItem("leetClockMode");
      if (savedMode && modeSettings[savedMode]) {
        mode = savedMode;
      }
      drawLabels(modeSettings[mode].hours, modeSettings[mode].minutes);
      document.getElementById(
        "toggleMode"
      ).textContent = `Mode: ${modeSettings[mode].label}`;

      // Apply visual effects based on the loaded mode
      applyVisualEffects(mode);

      const savedTheme = localStorage.getItem("leetClockTheme");
      if (savedTheme === "dark" || savedTheme === "light") {
        setTheme(savedTheme === "dark");
      }

      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
          (position) => {
            window.userLocation = {
              latitude: position.coords.latitude,
              longitude: position.coords.longitude,
            };
            updateClock();
          },
          (error) => {
            console.warn("Geolocation error:", error);
          }
        );
      } else {
        console.warn("Geolocation not supported.");
      }

      updateQuote();
      setInterval(updateQuote, 3600000);
      setInterval(updateClock, 10);
      updateClock();

      const savedLat = localStorage.getItem("latitude");
      const savedLon = localStorage.getItem("longitude");
      if (savedLat && savedLon) {
        window.userLocation = {
          latitude: parseFloat(savedLat),
          longitude: parseFloat(savedLon),
        };
        document.getElementById("latInput").value = savedLat;
        document.getElementById("lonInput").value = savedLon;
      }

      document
        .getElementById("setLocationBtn")
        .addEventListener("click", () => {
          const lat = parseFloat(document.getElementById("latInput").value);
          const lon = parseFloat(document.getElementById("lonInput").value);
          if (!isNaN(lat) && !isNaN(lon)) {
            window.userLocation = { latitude: lat, longitude: lon };
            localStorage.setItem("latitude", lat);
            localStorage.setItem("longitude", lon);
            updateClock();
          } else {
            alert("Please enter valid coordinates.");
          }
        });

      document.getElementById("useGeoBtn").addEventListener("click", () => {
        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(
            (position) => {
              const { latitude, longitude } = position.coords;
              window.userLocation = { latitude, longitude };
              document.getElementById("latInput").value = latitude.toFixed(4);
              document.getElementById("lonInput").value = longitude.toFixed(4);
              localStorage.setItem("latitude", latitude);
              localStorage.setItem("longitude", longitude);
              updateClock();
            },
            (error) => alert("Failed to get location: " + error.message)
          );
        } else {
          alert("Geolocation not supported.");
        }
      });

      document.getElementById("citySelect").addEventListener("change", (e) => {
        const val = e.target.value;
        if (val) {
          const [lat, lon] = val.split(",").map(Number);
          document.getElementById("latInput").value = lat;
          document.getElementById("lonInput").value = lon;
          window.userLocation = { latitude: lat, longitude: lon };
          localStorage.setItem("latitude", lat);
          localStorage.setItem("longitude", lon);
          updateClock();
        }
      });

      document
        .getElementById("resetLocationBtn")
        .addEventListener("click", () => {
          window.userLocation = { latitude: 60.1699, longitude: 24.9384 };
          localStorage.removeItem("latitude");
          localStorage.removeItem("longitude");
          document.getElementById("latInput").value = "";
          document.getElementById("lonInput").value = "";
          document.getElementById("citySelect").value = "";
          updateClock();
        });
    </script>
  </body>
</html>
